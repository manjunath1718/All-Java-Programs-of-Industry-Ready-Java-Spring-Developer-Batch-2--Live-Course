package com.telusko.service;

import org.springframework.stereotype.Service;
import org.springframework.web.reactive.function.client.WebClient;

import com.telusko.model.Passenger;
import com.telusko.model.Ticket;

import reactor.core.Disposable;

@Service
public class TicketBookingService implements ITicketBookingService {

	private String BOOK_TICKET_URL=
			"http://localhost:8585/TicketBookingAPI/api/book-ticket/getTicketNumber";

	private String TICKET_INFO_URL=
			"http://localhost:8585/TicketBookingAPI/api/book-ticket/getTicket/{ticketNumber}";

	
	@Override
	public Ticket registerPassenger(Passenger passenger) {
		

		System.out.println("Registering Passenger");
		
		WebClient webClient = WebClient.create();
		Ticket response = webClient.post()
		.uri(BOOK_TICKET_URL)
		.bodyValue(passenger)
		.retrieve()
		.bodyToMono(Ticket.class)
		.block();
		
		System.out.println("Getting Ticket Number"+response.getTicketNumber());
		
		return response;
	}

	@Override
	public Ticket getFullTicketInfo(Integer ticketNumber) {

		System.out.println("Retrieving Full ticket");
		
		WebClient webClient = WebClient.create();
	    webClient.get()
		.uri(TICKET_INFO_URL, ticketNumber)
		.retrieve()
		.bodyToMono(String.class)
		.subscribe(TicketBookingService::handleRespone);
	
		System.out.println("Got full Ticket ");
//		return response;
		
	}
	
	public static void handleRespone(String ticket){
		
		System.out.println(ticket);
	}

}
